<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate and perform Ordered Quantile normalizing transformation — orderNorm • bestNormalize</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate and perform Ordered Quantile normalizing transformation — orderNorm" />
<meta property="og:description" content="The Ordered Quantile (ORQ) normalization transformation,
  orderNorm(), is a rank-based procedure by which the values of a
  vector are mapped to their percentile, which is then mapped to the same
  percentile of the normal distribution. Without the presence of ties, this
  essentially guarantees that the transformation leads to a uniform
  distribution.
The transformation is: $$g(x) = \Phi ^ {-1} ((rank(x) - .5) /
  (length(x)))$$
Where \(\Phi\) refers to the standard normal cdf, rank(x) refers to each
  observation's rank, and length(x) refers to the number of observations.
By itself, this method is certainly not new; the earliest mention of it
  that I could find is in a 1947 paper by Bartlett (see references). This
  formula was outlined explicitly in Van der Waerden, and expounded upon in
  Beasley (2009). However there is a key difference to this version of it, as
  explained below.
Using linear interpolation between these percentiles, the ORQ normalization
  becomes a 1-1 transformation that can be applied to new data. However,
  outside of the observed domain of x, it is unclear how to extrapolate the
  transformation. In the ORQ normalization procedure, a binomial glm with a
  logit link is used on the ranks in order to extrapolate beyond the bounds
  of the original domain of x. The inverse normal CDF is then applied to
  these extrapolated predictions in order to extrapolate the transformation.
  This mitigates the influence of heavy-tailed distributions while preserving
  the 1-1 nature of the transformation. The extrapolation will provide a
  warning unless warn = FALSE.) However, we found that the extrapolation was
  able to perform very well even on data as heavy-tailed as a Cauchy
  distribution (paper to be published).
The fit used to perform the extrapolation uses a default of 10000
  observations (or length(x) if that is less). This added approximation
  improves the scalability, both computationally and in terms of memory used.
  Do not set this value to be too low (e.g. &amp;lt;100), as there is no benefit to
  doing so. Increase if your test data set is large relative to 10000 and/or 
  if you are worried about losing signal in the extremes of the range.
This transformation can be performed on new data and inverted via the
  predict function." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bestNormalize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bestNormalize.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/customization.html">Customization within bestNormalize</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/petersonR/bestNormalize/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate and perform Ordered Quantile normalizing transformation</h1>
    <small class="dont-index">Source: <a href='https://github.com/petersonR/bestNormalize/blob/master/R/orderNorm.R'><code>R/orderNorm.R</code></a></small>
    <div class="hidden name"><code>orderNorm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The Ordered Quantile (ORQ) normalization transformation,
  <code>orderNorm()</code>, is a rank-based procedure by which the values of a
  vector are mapped to their percentile, which is then mapped to the same
  percentile of the normal distribution. Without the presence of ties, this
  essentially guarantees that the transformation leads to a uniform
  distribution.</p>
<p>The transformation is: $$g(x) = \Phi ^ {-1} ((rank(x) - .5) /
  (length(x)))$$</p>
<p>Where \(\Phi\) refers to the standard normal cdf, rank(x) refers to each
  observation's rank, and length(x) refers to the number of observations.</p>
<p>By itself, this method is certainly not new; the earliest mention of it
  that I could find is in a 1947 paper by Bartlett (see references). This
  formula was outlined explicitly in Van der Waerden, and expounded upon in
  Beasley (2009). However there is a key difference to this version of it, as
  explained below.</p>
<p>Using linear interpolation between these percentiles, the ORQ normalization
  becomes a 1-1 transformation that can be applied to new data. However,
  outside of the observed domain of x, it is unclear how to extrapolate the
  transformation. In the ORQ normalization procedure, a binomial glm with a
  logit link is used on the ranks in order to extrapolate beyond the bounds
  of the original domain of x. The inverse normal CDF is then applied to
  these extrapolated predictions in order to extrapolate the transformation.
  This mitigates the influence of heavy-tailed distributions while preserving
  the 1-1 nature of the transformation. The extrapolation will provide a
  warning unless warn = FALSE.) However, we found that the extrapolation was
  able to perform very well even on data as heavy-tailed as a Cauchy
  distribution (paper to be published).</p>
<p>The fit used to perform the extrapolation uses a default of 10000
  observations (or length(x) if that is less). This added approximation
  improves the scalability, both computationally and in terms of memory used.
  Do not set this value to be too low (e.g. &lt;100), as there is no benefit to
  doing so. Increase if your test data set is large relative to 10000 and/or 
  if you are worried about losing signal in the extremes of the range.</p>
<p>This transformation can be performed on new data and inverted via the
  <code>predict</code> function.</p>
    </div>

    <pre class="usage"><span class='fu'>orderNorm</span><span class='op'>(</span><span class='va'>x</span>, n_logit_fit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='fl'>10000</span><span class='op'>)</span>, <span class='va'>...</span>, warn <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># S3 method for orderNorm</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>object</span>, newdata <span class='op'>=</span> <span class='cn'>NULL</span>, inverse <span class='op'>=</span> <span class='cn'>FALSE</span>, warn <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for orderNorm</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A vector to normalize</p></td>
    </tr>
    <tr>
      <th>n_logit_fit</th>
      <td><p>Number of points used to fit logit approximation</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments</p></td>
    </tr>
    <tr>
      <th>warn</th>
      <td><p>transforms outside observed range or ties will yield warning</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>an object of class 'orderNorm'</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>a vector of data to be (reverse) transformed</p></td>
    </tr>
    <tr>
      <th>inverse</th>
      <td><p>if TRUE, performs reverse transformation</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of class <code>orderNorm</code> with elements</p>
<p></p>
<dt>x.t</dt><dd><p>transformed original data</p></dd> <dt>x</dt><dd><p>original data</p></dd>
  <dt>n</dt><dd><p>number of nonmissing observations</p></dd> <dt>ties_status</dt><dd><p>indicator if
  ties are present</p></dd> <dt>fit</dt><dd><p>fit to be used for extrapolation, if needed</p></dd>
  <dt>norm_stat</dt><dd><p>Pearson's P / degrees of freedom</p></dd>

  The predict function returns the numeric value of the transformation
  performed on new data, and allows for the inverse transformation as well.

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Bartlett, M. S. "The Use of Transformations." Biometrics, vol. 3, no. 1,
1947, pp. 39-52. JSTOR www.jstor.org/stable/3001536.</p>
<p>Van der Waerden BL. Order tests for the two-sample problem and their power.
1952;55:453-458. Ser A.</p>
<p>Beasley TM, Erickson S, Allison DB. Rank-based inverse normal transformations
are increasingly used, but are they merited? Behav. Genet. 2009;39(5):
580-595. pmid:19526352</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='boxcox.html'>boxcox</a></code>, <code><a href='lambert.html'>lambert</a></code>,
  <code><a href='bestNormalize.html'>bestNormalize</a></code>, <code><a href='yeojohnson.html'>yeojohnson</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>orderNorm_obj</span> <span class='op'>&lt;-</span> <span class='fu'>orderNorm</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='va'>orderNorm_obj</span>
</div><div class='output co'>#&gt; orderNorm Transformation with 100 nonmissing obs and no ties 
#&gt;  - Original quantiles:
#&gt;    0%   25%   50%   75%  100% 
#&gt; 0.004 0.249 0.600 1.116 9.274 </div><div class='input'><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>orderNorm_obj</span><span class='op'>)</span>
<span class='va'>x2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>orderNorm_obj</span>, newdata <span class='op'>=</span> <span class='va'>p</span>, inverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='va'>x2</span>, <span class='va'>x</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Ryan Andrew Peterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


